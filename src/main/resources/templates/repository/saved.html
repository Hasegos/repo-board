<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>μ €μ¥ν• λ ν¬μ§€ν† λ¦¬</title>
    <link rel="stylesheet" th:src="@{/css/pages/saved.css}">
</head>
<body>
    <header th:replace="~{fragments/header :: header}"></header>
    <main>
        <div class="saved-repos">
            <h1 class="saved-repos__title">μ €μ¥ν• λ ν¬μ§€ν† λ¦¬</h1>

            <div class="saved-repos__filters">
                <select name="language">
                    <option value="">μ–Έμ–΄ ν•„ν„°</option>
                    <option value="Java">Java</option>
                    <option value="Python">Python</option>
                    <option value="JavaScript">JavaScript</option>
                    <option value="C++">C++</option>
                </select>

                <select name="sort">
                    <option value="latest">μµμ‹ μ</option>
                    <option value="stars">λ³„μ μ</option>
                    <option value="forks">ν¬ν¬μ</option>
                </select>
            </div>

            <div th:if="${savedRepos.isEmpty()}" class="saved-repos__empty-message">
                μ €μ¥ν• λ ν¬μ§€ν† λ¦¬κ°€ μ—†μµλ‹λ‹¤.
            </div>

            <div th:if="${not #lists.isEmpty(savedRepos)}" class="repo-list">
                <div th:each="repo : ${savedRepos}" class="repo-card">
                    <div class="repo-card__header">
                        <a th:href="${repo.htmlUrl}" target="_blank" class="repo-card__title" th:text="${repo.name}">λ ν¬μ§€ν† λ¦¬ μ΄λ¦„</a>
                        <div class="repo-card__actions">
                            <form th:action="@{/saved-repos/pin/{id}(id=${repo.id})}" method="post">
                                <button type="submit" class="btn btn--pin">
                                    <img th:src="@{/images/pin-icon.svg}" alt="ν•€">
                                </button>
                            </form>
                            <button type="button" class="btn btn--toggle" onclick="toggleReadme(this)">μμ„Έν λ³΄κΈ°</button>
                            <form th:action="@{/saved-repos/delete/{id}(id=${repo.id})}" method="post">
                                <button type="submit" class="btn btn--delete">μ‚­μ </button>
                            </form>
                        </div>
                    </div>

                    <p class="repo-card__description" th:text="${repo.description}">λ ν¬μ§€ν† λ¦¬ μ„¤λ…</p>

                    <div class="repo-card__meta">
                        <span th:text="'β­ ' + ${repo.stars}">β­ 0</span>
                        <span th:text="'π΄ ' + ${repo.forks}">π΄ 0</span>
                        <span th:text="${repo.languageMain}">μ–Έμ–΄</span>
                        <span th:if="${repo.updatedAt != null}" th:text="'μ—…λ°μ΄νΈ: ' + ${#temporals.format(repo.updatedAt, 'yyyy-MM-dd')}">μ—…λ°μ΄νΈ λ‚ μ§</span>
                    </div>

                    <div class="repo-card__note">
                        <span th:if="${repo.isPinned}">π“ κ³ μ •λ λ ν¬μ§€ν† λ¦¬</span>
                    </div>

                    <!-- π“ README νΌμΉκΈ° λ²„νΌ -->
                    <button type="button" class="btn btn--toggle" onclick="toggleReadme(this)">
                        <span class="toggle-label">Readme μƒμ„Έν λ³΄κΈ°</span>
                        <span class="arrow">β–Ό</span>
                    </button>

                    <!-- π“ README λ‚΄μ© λ°•μ¤ -->
                    <div class="repo-card__readme">
                        <div class="readme-content loading">λ΅λ”© μ¤‘...</div>
                    </div>

                    <div class="repo-card__memo">
                        <form th:action="@{/saved-repos/memo/{id}(id=${repo.id})}" method="post">
                            <textarea name="memo" placeholder="λ©”λ¨λ¥Ό μ…λ ¥ν•μ„Έμ”..." th:text="${repo.note}" readonly></textarea>
                            <button type="submit" class="btn" style="margin-top: 8px;">λ©”λ¨ μ €μ¥</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <footer th:replace="~{fragments/footer :: footer}"></footer>
    <script th:src="@{/js/saved.js}"></script>
</body>
</html>