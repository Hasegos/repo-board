<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ì €ì¥í•œ ë ˆí¬ì§€í† ë¦¬</title>
    <link rel="stylesheet" th:src="@{/css/pages/saved.css}">

</head>
<body>
    <header th:replace="~{fragments/header :: header}"></header>
    <main>
        <div class="saved-repos">
            <h1 class="saved-repos__title">ì €ì¥í•œ ë ˆí¬ì§€í† ë¦¬</h1>

            <div class="saved-repos__filters">
                <select name="language">
                    <option value="">ì–¸ì–´ í•„í„°</option>
                    <option value="Java">Java</option>
                    <option value="Python">Python</option>
                    <option value="JavaScript">JavaScript</option>
                    <option value="C++">C++</option>
                </select>

                <select name="sort">
                    <option value="latest">ìµœì‹ ìˆœ</option>
                    <option value="stars">ë³„ì ìˆœ</option>
                    <option value="forks">í¬í¬ìˆœ</option>
                </select>
            </div>

            <div th:if="${savedRepos.isEmpty()}" class="saved-repos__empty-message">
                ì €ì¥í•œ ë ˆí¬ì§€í† ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.
            </div>

            <div th:if="${not #lists.isEmpty(savedRepos)}" class="repo-list">
                <div th:each="repo : ${savedRepos}" class="repo-card">
                    <div class="repo-card__header">
                        <a th:href="${repo.htmlUrl}" target="_blank" class="repo-card__title" th:text="${repo.name}">ë ˆí¬ì§€í† ë¦¬ ì´ë¦„</a>
                        <div class="repo-card__actions">
                            <form th:action="@{/saved-repos/pin/{id}(id=${repo.id})}" method="post">
                                <button type="submit" class="btn btn--pin">
                                    <img th:src="@{/images/pin-icon.svg}" alt="í•€">
                                </button>
                            </form>
                            <button type="button" class="btn btn--toggle" onclick="toggleReadme(this)">ìì„¸íˆ ë³´ê¸°</button>
                            <form th:action="@{/saved-repos/delete/{id}(id=${repo.id})}" method="post">
                                <button type="submit" class="btn btn--delete">ì‚­ì œ</button>
                            </form>
                        </div>
                    </div>

                    <p class="repo-card__description" th:text="${repo.description}">ë ˆí¬ì§€í† ë¦¬ ì„¤ëª…</p>

                    <div class="repo-card__meta">
                        <span th:text="'â­ ' + ${repo.stargazersCount}">â­ 0</span>
                        <span th:text="'ğŸ´ ' + ${repo.forksCount}">ğŸ´ 0</span>
                        <span th:text="${repo.language}">ì–¸ì–´</span>
                        <span th:if="${repo.updatedAt != null}" th:text="'ì—…ë°ì´íŠ¸: ' + ${#temporals.format(repo.updatedAt, 'yyyy-MM-dd')}">ì—…ë°ì´íŠ¸ ë‚ ì§œ</span>
                    </div>

                    <div class="repo-card__note">
                        <span th:if="${repo.isPinned}">ğŸ“Œ ê³ ì •ëœ ë ˆí¬ì§€í† ë¦¬</span>
                        <span th:if="${repo.isPrivate}">ğŸ”’ ë¹„ê³µê°œ</span>
                    </div>

                    <div class="repo-card__preview" th:if="${repo.readmePreview != null}" th:text="${repo.readmePreview}">
                        README ë¯¸ë¦¬ë³´ê¸° ë‚´ìš©
                    </div>

                    <div class="repo-card__memo">
                        <form th:action="@{/saved-repos/memo/{id}(id=${repo.id})}" method="post">
                            <textarea name="memo" placeholder="ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." th:text="${repo.memo}" readonly></textarea>
                            <button type="submit" class="btn" style="margin-top: 8px;">ë©”ëª¨ ì €ì¥</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <footer th:replace="~{fragments/footer :: footer}"></footer>
    <script>
        function toggleReadme(button) {
            const preview = button.closest('.repo-card').querySelector('.repo-card__preview');
            button.classList.toggle('expanded');
            preview.style.display = preview.style.display === 'none' ? 'block' : 'none';
        }
    </script>
</body>
</html>